--source include/have_debug.inc
--source include/have_binlog_format_mixed.inc

# MDEV-25395 server recovery hits replication event checksum error
#
# Check that the server restarts without any issue, specifically no MDEV reported
# errors exists.

--connection default
set @@global.binlog_checksum=none;
set @@session.debug_dbug='d,crash_before_write_second_checkpoint_event';
--exec echo "wait" > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
--error 2013
set @@global.binlog_checksum=crc32;
--source include/wait_until_disconnected.inc

#
--append_file $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
restart: --master-verify-checksum=1
EOF

--connection default
--enable_reconnect
--source include/wait_until_connected_again.inc

# Proof:
# check error log for lack of error messages of the report.
--let $log_error_ = $MYSQLTEST_VARDIR/log/mysqld.1.err
--let SEARCH_FILE=$log_error_
--let SEARCH_PATTERN=Replication event checksum verification failed
--source include/search_pattern_in_file.inc

--echo End of the tests
